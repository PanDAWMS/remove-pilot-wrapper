<html>
<body>

<a href='#input options'>Input options</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrappervo'>wrappervo</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperwmsqueue'>wrapperwmsqueue</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperbatchqueue'>wrapperbatchqueue</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrappergrid'>wrappergrid</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperpurpose'>wrapperpurpose</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrappertarballurl'>wrappertarballurl</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperpilotcodeurl'>wrapperpilotcodeurl</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperspecialcmd'>wrapperspecialcmd</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperplugin'>wrapperplugin</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperpilotcode'>wrapperpilotcode</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrapperloglevel'>wrapperloglevel</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#wrappermode'>wrappermode</a><br>

<a href='#lookup table'>Look up table (plugins.conf) </a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#tablecolumns'>columns</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#tablesymbols'>symbols</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#tableexample'>example</a><br>

<a href='#notes'>Notes</a><br>


<a name='input options'><h2><span style="color: black; "><span>Input Options</span></span></h2></a>

<ul>

<a name='wrappervo'></a>
<li><strong>wrappervo</strong><pre>is the VO
</pre>
</li>

<a name='wrapperwmsqueue'></a>
<li><strong>wrapperwmsqueue</strong><pre>is the wms queue (e.g. the panda siteid)
</pre>
</li>

<a name='wrapperbatchqueue'></a>
<li><strong>wrapperbatchqueue</strong><pre>is the batch queue (e.g. the panda queue)
</pre>
</li>

<a name='wrappergrid'></a>
<li><strong>wrappergrid</strong><pre>is the grid flavor, i.e. OSG or EGEE (or gLite). 
The reason to include it as an input option,
instead of letting the wrapper to discover by itself
the current platform is to be able to distinguish
between these two scenarios:

  (a) running on local cluster
  (b) running on grid, but the setup file is missing

(b) is a failure and should be reported, whereas (a) is fine.

A reason to include wrappergrid as an option in this very first wrapper
is that for sites running condor as local batch system, 
the $PATH environment variable is setup only after sourcing the 
OSG setup file. And only with $PATH properly setup 
is possible to perform actions as curl/wget 
to download the rest of files, or python to execute them.
</pre>
</li>

<a name='wrapperpurpose'></a>
<li><strong>wrapperpurpose</strong><pre>will be the VO in almost all cases,
but not necessarily when several groups share
the same VO. An example is VO OSG, shared by 
CHARMM, Daya, OSG ITB testing group...
</pre>
</li>

<a name='wrappertarballurl'></a>
<li><strong>wrappertarballurl</strong><pre>is the complete url with the wrapper tarball to be downloaded
including the name of the actual tarball file.

DEFAULT: http://dev.racf.bnl.gov/dist/wrapper/wrapper.tar.gz
</pre>
</li>

<a name='wrapperpilotcodeurl'></a>
<li><strong>wrapperpilotcodeurl</strong><pre>is the base url with the pilot code to be downloaded.
It can be a single value, or a list of values split by comma.
</pre>
</li>

<a name='wrapperspecialcmd'></a>
<li><strong>wrapperspecialcmd</strong><pre>is special command to be performed, 
for some specific reason, just after sourcing the Grid environment,
but before doing anything else.
This has been triggered by the need to execute command
     $ module load <module_name>
at NERSC after sourcing the OSG grid environment. 
</pre>
</li>

<a name='wrapperplugin'></a>
<li><strong>wrapperplugin</strong><pre>is the plug-in module with the code corresponding to the final wrapper flavor.
</pre>
</li>

<a name='wrapperpilotcode'></a>
<li><strong>wrapperpilotcode</strong><pre>is the actual pilot code to be executed at the end.
Each VO plugin is supposed to understand the format:
for example, it could just be the basename of an executable to be run as it is,
or it can be the name of tarball, and the plugin will add the ".tar.gz" suffix. 
</pre>
</li>

<a name='wrapperloglevel'></a>
<li><strong>wrapperloglevel</strong><pre>is a flag to activate high verbosity mode.
Accepted values are debug or info.  
</pre>
</li>

<a name='wrappermode'></a>
<li><strong>wrappermode</strong><pre>allows performing all steps but querying and running a real job.
</pre>
</li>


</ul>


<a name='lookup table'><h2><span style"color: black;"><span>Look up table (plugins.conf) </span></span></h2></a>

<a name="tablecolumns"><h3><span style="color: black; "><span>Columns</span></span></h3></a>

<p>
Each column has the same value for every row.
The first N columns are the patterns, and the rest are outputs. 
That means that a number N of input values will be provided each time,
the row maching with those inputs is selected, and the output values will be returned.
Columns will be parsed for matching from left to right.
This means the first column is the most important field for matching, 
the second column is the next most important field, and so on. 
When one of the provided inputs matches exactly the content of the field in the table,
that row is selected.
In the given input is not provided, or it is not in the table, then fields with 
symbols are inspected. 
If no row matches completely with the input values, then None should be returned.
</p>

<p>
See documentation in wrapper.sh for details on the content and format of each variable.
</p>


<a name="tablesymbols"><h3><span style="color: black; "><span>Symbols</span></span></h3></a>

<pre>
Definitions:

        + means any value is accepted, but one must be provided
        * means any value is accepted, or no value was provided
        - means no value was provided

Order of precedence:

   -- if no value was provided for a given field:
                1) first '-' will be used
                2) if the field is not '-', then '*' will be checked

   -- if a value was provided for a given field:
                1) the value is searched
                2) if the value is not in the field, the '+' will be checked
                3) finally, '*" will be checked
</pre>


<a name="tableexample"><h3><span style="color: black; "><span>Example</span></span></h3></a>

<pre>
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  
#   VO          PURPOSE           GRID            WMSQUEUE              BATCHQUEUE                            PLUGIN                  PILOTCODE                   PILOTCODEURL 
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  
                                          
# --- default values ---
    ATLAS       *                 OSG             +                     +                                     atlasprodpilot         pilotcode,pilotcode-rc       http://pandaserver.cern.ch:25080/cache/pilot
    ATLAS       *                 EGI             +                     +                                     atlasprodpilotegi      pilotcode,pilotcode-rc       http://pandaserver.cern.ch:25080/cache/pilot
    OSG         *                 OSG             +                     +                                     trivial                trivialPilot                 http://pandaserver.cern.ch:25080/cache/pilot
    AMS         *                 *               +                     +                                     trivial                trivialPilot                 http://pandaserver.cern.ch:25080/cache/pilot

# --- testing releases ---
    OSG         TESTING           OSG             +                     +                                     trivial                --                           --
    ATLAS       TESTING           OSG             +                     +                                     atlasprodpilot         pilotcode-testing            http://project-atlas-gmsb.web.cern.ch/project-atlas-gmsb
    ATLAS       DEV               OSG             +                     +                                     atlasprodpilot         pilotcode-dev                http://project-atlas-gmsb.web.cern.ch/project-atlas-gmsb

# --- testing sites ---                       
    OSG         *                 *               TEST1                 TEST1                                 trivial                 trivialPilot                http://pandaserver.cern.ch:25080/cache/pilot
    OSG         *                 *               TEST2                 TEST2                                 trivial                 trivialPilot                http://pandaserver.cern.ch:25080/cache/pilot
    OSG         *                 *               TEST3                 TEST3                                 trivial                 trivialPilot                http://pandaserver.cern.ch:25080/cache/pilot
    ATLAS       *                 *               ANALY_TEST-APF        ANALY_TEST-APF-condor                 atlasprodpilot          pilotcode,pilotcode-rc      http://pandaserver.cern.ch:25080/cache/pilot
    ATLAS       *                 *               ANALY_TEST-APF2       ANALY_TEST-APF2-condor                atlasprodpilot          pilotcode,pilotcode-rc      http://pandaserver.cern.ch:25080/cache/pilot
    ATLAS       *                 *               BNL_TEST_APF          BNL_TEST_APF-condor                   atlasprodpilot          pilotcode,pilotcode-rc      http://pandaserver.cern.ch:25080/cache/pilot

</pre>


<a name='notes'><h2><span style="color: black; "><span>Notes</span></span></h2></a>

<pre>
       before the input options are parsed, they must be re-tokenized
       so whitespaces as part of the value 
       (i.e. --wrapperspecialcmd='module load osg')
       create no confussion and are not taken as they are splitting 
       different input options.

       The format in the condor submission file (or JDL) to address 
       the multi-words values is:

          arguments = "--in1=val1 ... --inN=valN --cmd=""module load osg"""
</pre>

</body>
</html>
